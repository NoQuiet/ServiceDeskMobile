# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Мобильное приложение Service Desk Mobile

**Дата составления:** 19 декабря 2024  
**Версия документа:** 1.0  
**Дата сдачи проекта:** 08.12.2024

---

## 1. КРАТКОЕ ОПИСАНИЕ ПРОЕКТА

**Название мобильного приложения:** Service Desk Mobile

**Описание:**  
Service Desk Mobile — это мобильное приложение для автоматизации работы службы технической поддержки организации. Система позволяет пользователям создавать заявки на решение технических проблем с возможностью прикрепления фотографий, отслеживать статус выполнения, общаться со специалистами через систему комментариев и оценивать качество работы. Специалисты поддержки могут просматривать все активные заявки, брать их в работу, изменять статусы и взаимодействовать с пользователями. Администраторы имеют полный контроль над системой, включая управление пользователями, назначение исполнителей и доступ к архиву заявок.

**Цель:**  
Создание эффективного инструмента для управления заявками технической поддержки с возможностью мобильного доступа, что позволит:
- Ускорить процесс обработки заявок за счет мобильного доступа
- Улучшить коммуникацию между пользователями и специалистами через систему комментариев
- Повысить прозрачность работы службы поддержки благодаря отслеживанию статусов
- Обеспечить возможность прикрепления фотографий для наглядной демонстрации проблем
- Собирать обратную связь через систему оценок для улучшения качества обслуживания
- Централизовать управление пользователями и распределение нагрузки между специалистами

**Аналоги:**
1. **Jira Service Desk** (Atlassian)
   - Комплексная система управления заявками с мобильным приложением
   - Недостатки: требует платной подписки ($20-75/агент/месяц), сложна в настройке, избыточный функционал для малых организаций

2. **Zendesk**
   - Облачная платформа поддержки клиентов с мобильным доступом
   - Недостатки: платная ($19-99/агент/месяц), ориентирована на крупный бизнес, требует интернет-соединения

3. **Freshdesk**
   - Система helpdesk с мобильным приложением, freemium модель
   - Недостатки: ограниченный функционал в бесплатной версии (макс. 10 агентов), реклама в интерфейсе

4. **ServiceNow**
   - Enterprise-решение для IT service management
   - Недостатки: очень высокая стоимость (от $100/пользователь/месяц), сложность внедрения

5. **osTicket**
   - Open-source система тикетов
   - Недостатки: отсутствует полноценное мобильное приложение, устаревший интерфейс

**Преимущества нашего решения:**
- ✅ Полностью бесплатное и open-source
- ✅ Простота развертывания и настройки
- ✅ Нативное Android приложение с современным Material Design 3
- ✅ Встроенная поддержка загрузки фотографий к заявкам и комментариям
- ✅ Адаптировано под нужды небольших и средних организаций
- ✅ Возможность самостоятельного хостинга (контроль над данными)
- ✅ Минимальные требования к серверу

**Дата сдачи:** 08.12.2024

---

## 2. ОСНОВНЫЕ ТРЕБОВАНИЯ (ФУНКЦИОНАЛЬНЫЕ)

### 2.1. Пользовательские роли

#### **Пользователь (user) — базовая роль**
Возможности:
- ✅ Регистрация с заполнением профиля (ФИО, email, телефоны, этаж, кабинет, должность)
- ✅ Вход в систему (email/password) с проверкой блокировки аккаунта
- ✅ Создание заявок в техподдержку с подробным описанием проблемы
- ✅ Прикрепление до 5 фотографий к заявке (макс. 5 МБ каждое, форматы: JPG, PNG)
- ✅ Просмотр списка только своих заявок
- ✅ Просмотр детальной информации о своих заявках
- ✅ Добавление комментариев к своим заявкам
- ✅ Прикрепление фотографий к комментариям (до 5 штук)
- ✅ Удаление своих комментариев
- ✅ Оценка выполненной работы (1-5 звезд) после решения заявки
- ✅ Просмотр истории комментариев и изменений статусов
- ✅ Редактирование своего профиля

#### **Специалист техподдержки (support) — расширенная роль**
Все возможности пользователя +
- ✅ Просмотр всех активных заявок в системе (не только своих)
- ✅ Фильтрация заявок: все / мои / назначенные мне
- ✅ Взятие заявки в работу (самоназначение) с автоматическим изменением статуса
- ✅ Изменение статуса заявки: новая → в работе → решена → закрыта
- ✅ Добавление комментариев к любым заявкам
- ✅ Просмотр полной контактной информации всех пользователей
- ✅ Возможность взять заявку, даже если она уже назначена на другого специалиста

#### **Администратор (admin) — полный доступ**
Все возможности специалиста +
- ✅ Просмотр списка всех пользователей системы
- ✅ Создание новых специалистов техподдержки
- ✅ Изменение ролей пользователей (user ↔ support ↔ admin)
- ✅ Блокировка/разблокировка учетных записей (запрет входа)
- ✅ Удаление пользователей из системы (с каскадным удалением данных)
- ✅ Назначение заявок на конкретных специалистов
- ✅ Переназначение исполнителей между специалистами
- ✅ Просмотр архива всех выполненных заявок
- ✅ Модерация всех переписок в системе

### 2.2. Базовый функционал (MVP)

#### 1. **Аутентификация и авторизация**
- Регистрация по email/password с валидацией данных на клиенте и сервере
- Проверка уникальности email при регистрации
- Вход в систему с проверкой блокировки аккаунта
- JWT токены для авторизации (срок действия 24 часа)
- Автоматический выход при истечении токена или ошибке 401
- Безопасное хранение токенов в DataStore Preferences
- Хеширование паролей с использованием bcrypt (10 раундов)

#### 2. **Профиль пользователя**
Обязательные поля:
- Имя (first_name)
- Фамилия (last_name)
- Email (уникальный)
- Пароль (минимум 6 символов)

Дополнительные поля:
- Должность (position)
- Мобильный телефон (mobile_phone)
- Внутренний телефон (internal_phone)
- Этаж (floor)
- Номер кабинета (office_number)

Функции:
- Отображение роли пользователя (badge)
- Возможность редактирования профиля
- Выход из системы с очисткой токена

#### 3. **Управление заявками**

**Создание заявки:**
- Заголовок (обязательно, до 255 символов)
- Подробное описание проблемы (обязательно, текстовое поле)
- Прикрепление фотографий через галерею (до 5 шт., форматы: JPG, JPEG, PNG)
- Превью выбранных изображений с возможностью удаления до отправки
- Автоматическое определение автора (из токена)
- Автоматическая установка даты создания
- Статус по умолчанию: "Новая" (new)
- Приоритет по умолчанию: "Средний" (medium)

**Просмотр списка заявок:**
- Карточный интерфейс с Material Design 3
- Отображаемая информация на карточке:
  - Номер заявки (#ID)
  - Заголовок (крупный шрифт)
  - Описание (первые 2-3 строки)
  - Статус (цветной chip)
  - Приоритет (цветной chip)
  - Дата создания (относительная: "сегодня", "вчера", дата)
  - Автор (имя, фамилия)
  - Исполнитель (если назначен)
- Цветовая индикация статусов и приоритетов
- Pull-to-refresh для обновления списка
- Фильтрация (для support/admin):
  - Все заявки
  - Мои заявки (где я автор)
  - Назначенные мне (где я исполнитель)

**Детальный просмотр заявки:**
- Полная информация о заявке
- Галерея прикрепленных фотографий (горизонтальная прокрутка, 120x120dp)
- Карточка с контактной информацией автора:
  - Имя, фамилия
  - Email (кликабельный)
  - Должность
  - Мобильный телефон (кликабельный)
  - Внутренний телефон
  - Этаж, номер кабинета
- Информация об исполнителе (если назначен)
- История комментариев
- Кнопки действий (в зависимости от роли)

#### 4. **Статусы заявок**
- **new** (Новая) — заявка только что создана, ожидает обработки
  - Цвет: синий (#2196F3)
  - Доступна всем ролям для просмотра
  
- **in_progress** (В работе) — специалист работает над решением
  - Цвет: оранжевый (#FF9800)
  - Автоматически устанавливается при взятии в работу
  
- **resolved** (Решена) — проблема решена, ожидается оценка пользователя
  - Цвет: зеленый (#4CAF50)
  - После оценки можно закрыть
  
- **closed** (Закрыта) — заявка полностью завершена
  - Цвет: серый (#9E9E9E)
  - Финальный статус

**Примечание:** Статус "archived" существует в БД для совместимости, но удален из UI выбора.

#### 5. **Приоритеты заявок**
- **low** (Низкий) — несрочные проблемы
  - Цвет: зеленый (#4CAF50)
  
- **medium** (Средний) — стандартные проблемы, по умолчанию
  - Цвет: желтый (#FFC107)
  
- **high** (Высокий) — важные проблемы, требуют быстрого решения
  - Цвет: оранжевый (#FF9800)
  
- **critical** (Критический) — критичные проблемы, максимальный приоритет
  - Цвет: красный (#F44336)

#### 6. **Система комментариев**
- Добавление текстовых комментариев к заявкам
- Прикрепление до 5 фотографий к каждому комментарию
- Превью выбранных изображений перед отправкой
- Автоматическая очистка поля ввода и превью после отправки
- Отображение информации о комментарии:
  - Автор (имя, фамилия)
  - Роль автора (для цветовой индикации)
  - Дата и время создания
  - Текст комментария
  - Галерея прикрепленных фотографий (100x100dp)
- Цветовая индикация роли:
  - Синий фон (#E3F2FD) для обычных пользователей
  - Фиолетовый фон (#F3E5F5) для специалистов и администраторов
- Удаление своих комментариев с подтверждающим диалогом
- Автоматическое обновление списка после добавления/удаления
- Прокрутка к последнему комментарию после добавления

#### 7. **Оценка качества работы**
- Возможность оценить работу после перевода заявки в статус "Решена"
- Шкала оценки: 1-5 звезд (интерактивные иконки)
- Оценка доступна только автору заявки
- Можно оценить только один раз (повторная оценка заменяет предыдущую)
- Отображение оценки в карточке заявки (золотые звезды)
- Сохранение оценки в БД (поле rating в таблице tickets)

#### 8. **Работа с изображениями**

**Загрузка:**
- Выбор изображений из галереи устройства через Activity Result API
- Поддержка множественного выбора (до 5 файлов за раз)
- Ограничение размера: максимум 5 МБ на один файл
- Поддерживаемые форматы: JPEG, JPG, PNG
- Превью выбранных изображений в UI
- Возможность удаления изображения из превью до отправки
- Валидация размера и формата на клиенте и сервере

**Хранение на сервере:**
- Директория: `backend/uploads/`
- Структура:
  - `uploads/tickets/{ticketId}/` — фотографии заявок
  - `uploads/comments/{commentId}/` — фотографии комментариев
- Уникальные имена файлов: `{timestamp}_{originalName}`
- Сохранение метаданных в БД (имя, путь, размер, MIME-type)

**Отображение:**
- Загрузка через библиотеку Coil с автоматическим кешированием
- В заявках: горизонтальная галерея с превью 120x120px
- В комментариях: горизонтальная галерея с превью 100x100px
- Скругленные углы (8dp) в стиле Material Design
- Адаптивное масштабирование (ContentScale.Crop)
- Плейсхолдер при загрузке
- Обработка ошибок загрузки

#### 9. **Управление пользователями (только admin)**
- Просмотр списка всех пользователей системы
- Отображаемая информация:
  - Имя, фамилия
  - Email
  - Роль (цветной chip: синий для user, фиолетовый для support, красный для admin)
  - Статус (активен/заблокирован)
  - Дата регистрации
- Цветовая индикация статуса:
  - Зеленый фон для активных пользователей
  - Красный фон для заблокированных
- Действия с пользователями:
  - Блокировка (запрет входа в систему, is_blocked = 1)
  - Разблокировка (восстановление доступа, is_blocked = 0)
  - Изменение роли (выбор из списка: user/support/admin)
  - Удаление пользователя с подтверждением (каскадное удаление данных)
- Создание новых специалистов поддержки:
  - Упрощенная форма регистрации
  - Автоматическое назначение роли support

#### 10. **Назначение исполнителей**
- **Самоназначение (support):**
  - Кнопка "Взять в работу" на странице заявки
  - Автоматическое изменение assigned_to на текущего пользователя
  - Автоматическое изменение статуса на "В работе"
  - Возможность взять заявку, даже если она уже назначена

- **Назначение администратором (admin):**
  - Кнопка "Назначить" / "Переназначить"
  - Диалог выбора специалиста из списка support/admin пользователей
  - Переназначение на другого специалиста
  - Сохранение истории назначений (через комментарии)

- **Отображение исполнителя:**
  - В списке заявок (имя, фамилия)
  - В детальной информации о заявке (полная карточка контактов)

#### 11. **Уведомления и обратная связь**
- Информативные Snackbar сообщения об успешных операциях
- Сообщения об ошибках с понятным описанием проблемы
- Подтверждающие AlertDialog для деструктивных действий:
  - Удаление комментария
  - Удаление пользователя
  - Блокировка пользователя
- Индикаторы загрузки (CircularProgressIndicator) при выполнении операций
- Disabled состояние кнопок во время обработки запроса

### 2.3. Нефункциональные требования

#### **Платформа и совместимость**
- Операционная система: Android 7.0+ (API 24+)
- Целевая версия: Android 14 (API 34)
- Поддержка различных размеров экранов: телефоны (4.5"-7"), планшеты (7"-10")
- Поддержка различных плотностей экрана: mdpi, hdpi, xhdpi, xxhdpi, xxxhdpi
- Ориентация: портретная (основная), альбомная (поддерживается)

#### **Производительность**
- Время отклика UI: < 200 ms на основные экраны при наличии сети
- Загрузка списка заявок: < 3 секунды (до 100 заявок)
- Загрузка детальной информации о заявке: < 2 секунды
- Загрузка изображений: < 2 секунды на фото (зависит от размера и скорости сети)
- Плавная прокрутка списков: 60 FPS
- Время запуска приложения: < 2 секунды (холодный старт)
- Потребление памяти: < 150 MB в обычном режиме
- Размер APK: < 20 MB

#### **Безопасность**
- HTTPS для всех API запросов (обязательно в продакшене)
- Хеширование паролей с использованием bcrypt (cost factor = 10)
- JWT токены с временем жизни 24 часа
- Безопасное хранение токенов в DataStore Preferences (зашифровано на уровне ОС)
- Валидация всех входных данных на клиенте и сервере
- Защита от SQL-инъекций через prepared statements
- Проверка прав доступа на уровне каждого API endpoint
- Ограничение размера и типа загружаемых файлов
- Проверка MIME-type файлов на сервере
- Проверка блокировки аккаунта при каждом входе
- Автоматический выход при истечении токена

#### **Конфиденциальность**
- Соответствие общим требованиям защиты персональных данных
- Возможность удаления аккаунта администратором
- Каскадное удаление всех данных пользователя при удалении аккаунта
- Ограничение доступа к личным данным по ролям
- Безопасное удаление файлов при удалении заявок/комментариев
- Логирование без сохранения чувствительных данных (паролей, токенов)

#### **Локализация**
- Основной язык: русский
- Все текстовые строки вынесены в ресурсы (strings.xml)
- Форматирование дат и времени по локали устройства
- Поддержка RTL (right-to-left) не требуется

#### **Доступность (Accessibility)**
- Контрастные цвета, соответствующие WCAG 2.1 Level AA
- Масштабирование шрифта (поддержка системных настроек)
- Крупные кликабельные элементы (минимум 48dp x 48dp)
- Понятные иконки с текстовыми подписями
- Информативные сообщения об ошибках
- Content descriptions для иконок (для screen readers)

#### **Надежность**
- Обработка всех возможных ошибок сети
- Graceful degradation при потере соединения
- Retry механизм для критичных операций
- Автоматическое переподключение к БД на сервере
- Логирование критических операций
- Резервное копирование БД (рекомендуется ежедневно)
- Восстановление состояния приложения после сбоя

#### **Масштабируемость**
- Поддержка до 1000 пользователей
- Поддержка до 10000 заявок
- Пагинация для больших списков (опционально, для будущих версий)
- Оптимизация запросов к БД (индексы на часто используемых полях)

---

## 3. ПРЕДЛОЖЕННЫЙ СТЕК ТЕХНОЛОГИЙ

### 3.1. Frontend (мобильное приложение)

**Основной стек:**
- **Язык программирования:** Kotlin 1.9.0
- **UI Framework:** Jetpack Compose 1.6.0
- **Дизайн-система:** Material Design 3 (Material You)
- **Архитектурный паттерн:** MVVM (Model-View-ViewModel)
- **Минимальная версия SDK:** API 24 (Android 7.0)
- **Целевая версия SDK:** API 34 (Android 14)

**Основные библиотеки:**
- **Навигация:** Navigation Compose 2.7.6
- **Асинхронность:** Kotlin Coroutines 1.7.3 + Flow
- **HTTP клиент:** Retrofit 2.9.0 + OkHttp 4.12.0
- **Сериализация JSON:** Gson 2.9.0
- **Загрузка изображений:** Coil 2.5.0
- **Хранение данных:** DataStore Preferences 1.0.0
- **Работа с изображениями:** Activity Result API (AndroidX)
- **Lifecycle:** AndroidX Lifecycle 2.7.0

**Инструменты разработки:**
- **IDE:** Android Studio Hedgehog (2023.1.1) или новее
- **Система сборки:** Gradle 8.2
- **Kotlin Gradle Plugin:** 1.9.0
- **Android Gradle Plugin:** 8.2.0

### 3.2. Backend (сервер)

**Основной стек:**
- **Платформа:** Node.js 18.x LTS
- **Framework:** Express.js 4.18+
- **База данных:** MySQL 8.0+
- **Язык запросов:** SQL

**Основные библиотеки:**
- **Аутентификация:** jsonwebtoken 9.0.2 (JWT)
- **Хеширование паролей:** bcrypt 5.1.1
- **Загрузка файлов:** Multer 1.4.5
- **CORS:** cors 2.8.5
- **Переменные окружения:** dotenv 16.3.1
- **MySQL клиент:** mysql2 3.6.5
- **Валидация:** express-validator 7.0.1 (опционально)

**Инструменты разработки:**
- **IDE:** Visual Studio Code
- **Пакетный менеджер:** npm 9.x
- **Автоперезагрузка:** nodemon 3.0.2 (dev dependency)

### 3.3. Инфраструктура

- **Контроль версий:** Git 2.40+
- **Хостинг репозитория:** GitHub
- **CI/CD:** GitHub Actions (опционально)
- **Хостинг backend:** Локальный сервер / VPS / облако
- **База данных:** MySQL Server 8.0 (локально или удаленно)
- **Файловое хранилище:** Локальная файловая система сервера

### 3.4. Обоснование выбора технологий

**Kotlin + Jetpack Compose:**
- Современный подход к разработке Android UI с декларативным синтаксисом
- Меньше boilerplate кода по сравнению с XML layouts
- Официальная поддержка Google и активное развитие
- Высокая производительность и плавность анимаций
- Material Design 3 из коробки с поддержкой Dynamic Color
- Удобная работа с состоянием через State и Flow
- Быстрая разработка благодаря Preview и Hot Reload

**Node.js + Express:**
- Быстрая разработка REST API с минимальным boilerplate
- Огромная экосистема библиотек (npm registry)
- Асинхронная обработка запросов (non-blocking I/O)
- Простота развертывания и масштабирования
- Хорошая производительность для небольших и средних нагрузок
- JavaScript/TypeScript — популярные языки с большим сообществом
- Легкость интеграции с различными БД

**MySQL:**
- Надежная и проверенная временем реляционная СУБД
- Отличная производительность для транзакционных операций
- Простота администрирования и резервного копирования
- Бесплатная и open-source (Community Edition)
- Хорошо подходит для структурированных данных (пользователи, заявки, комментарии)
- Поддержка ACID транзакций
- Богатый набор инструментов (Workbench, phpMyAdmin)

**JWT + bcrypt:**
- JWT — стандартный и проверенный метод аутентификации для REST API
- Stateless аутентификация (не требует хранения сессий на сервере)
- Легко масштабируется горизонтально
- bcrypt — надежный алгоритм хеширования паролей с защитой от rainbow tables
- Настраиваемый cost factor для баланса безопасности и производительности

**Multer:**
- Де-факто стандарт для обработки multipart/form-data в Express
- Простая конфигурация и использование
- Встроенная валидация размера и типа файлов
- Поддержка различных storage engines

---

## 4. РЕКОМЕНДУЕМЫЕ ИНСТРУМЕНТЫ РАЗРАБОТКИ

### 4.1. IDE и редакторы

**Android Studio** (Arctic Fox или новее)
- Официальная IDE для Android разработки
- Встроенная поддержка Kotlin и Jetpack Compose
- Compose Preview для быстрой разработки UI
- Мощные инструменты отладки и профилирования
- Интеграция с Gradle и Android SDK

**Visual Studio Code**
- Легковесный редактор для backend разработки
- Богатая экосистема расширений
- Встроенный терминал и Git интеграция
- Отличная поддержка JavaScript/TypeScript

**IntelliJ IDEA** (опционально)
- Универсальная IDE от JetBrains
- Поддержка Kotlin, JavaScript, SQL
- Мощный рефакторинг и code analysis

### 4.2. Дизайн и прототипирование

**Figma**
- Создание прототипов и дизайн-макетов
- Совместная работа над дизайном
- Экспорт ассетов для Android

**Material Theme Builder**
- Генерация цветовых схем Material Design 3
- Экспорт тем для Jetpack Compose
- Предпросмотр компонентов

**Adobe Color** (опционально)
- Создание цветовых палитр
- Проверка контрастности (WCAG)

### 4.3. Контроль версий и управление проектом

**Git**
- Распределенная система контроля версий
- Ветвление и слияние кода
- История изменений

**GitHub**
- Хостинг Git репозитория
- Issue tracking для багов и задач
- Projects для kanban досок
- Pull Requests для code review
- GitHub Actions для CI/CD

### 4.4. Тестирование API

**Postman**
- Тестирование REST API endpoints
- Создание коллекций запросов
- Автоматизация тестов API
- Генерация документации

**Thunder Client** (VSCode extension)
- Легковесная альтернатива Postman
- Интеграция с VSCode
- Простой интерфейс

**cURL** (командная строка)
- Быстрое тестирование endpoints
- Скриптование запросов

### 4.5. База данных

**MySQL Workbench**
- Визуальное проектирование схемы БД
- Выполнение SQL запросов
- Администрирование сервера
- Экспорт/импорт данных

**phpMyAdmin**
- Веб-интерфейс для MySQL
- Управление БД через браузер
- Простота использования

**DBeaver** (опционально)
- Универсальный клиент БД
- Поддержка множества СУБД
- Продвинутые возможности

### 4.6. Отладка и мониторинг

**Android Studio Profiler**
- Профилирование CPU, памяти, сети
- Анализ производительности UI
- Обнаружение утечек памяти

**Logcat**
- Просмотр логов Android приложения
- Фильтрация по тегам и уровням
- Real-time мониторинг

**Chrome DevTools**
- Отладка network запросов
- Инспектирование HTTP трафика

**Postman Console**
- Логи API запросов и ответов
- Отладка проблем с API

### 4.7. Дополнительные инструменты

**Gradle**
- Система сборки Android проекта
- Управление зависимостями
- Автоматизация задач

**npm**
- Менеджер пакетов для Node.js
- Управление зависимостями backend
- Скрипты для запуска сервера

**Nodemon**
- Автоматическая перезагрузка сервера при изменениях
- Ускорение разработки backend

**Git Bash / PowerShell**
- Командная строка для работы с Git
- Выполнение скриптов

---

## 5. АРХИТЕКТУРА И ДАННЫЕ

### 5.1. Архитектурная схема

```
┌─────────────────────────────────────────────────────────────────────┐
│                        ANDROID APPLICATION                           │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                    UI LAYER (Jetpack Compose)                   │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────┐│ │
│  │  │  Login   │ │ Register │ │  Ticket  │ │  Detail  │ │Admin ││ │
│  │  │  Screen  │ │  Screen  │ │   List   │ │  Screen  │ │Screen││ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────┘│ │
│  │  Composable functions, Material Design 3 components            │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                ↕                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                      VIEWMODEL LAYER                            │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐         │ │
│  │  │   Auth   │ │  Ticket  │ │ Comment  │ │   User   │         │ │
│  │  │ViewModel │ │ViewModel │ │ViewModel │ │ViewModel │         │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘         │ │
│  │  StateFlow, business logic, data transformation                │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                ↕                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                     REPOSITORY LAYER                            │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐         │ │
│  │  │   Auth   │ │  Ticket  │ │ Comment  │ │   User   │         │ │
│  │  │Repository│ │Repository│ │Repository│ │Repository│         │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘         │ │
│  │  Data access abstraction, API calls, error handling            │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                ↕                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                        DATA LAYER                               │ │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐│ │
│  │  │  Retrofit Client │  │   DataStore      │  │  ImageUtils  ││ │
│  │  │  (API Service)   │  │  (Token Storage) │  │              ││ │
│  │  └──────────────────┘  └──────────────────┘  └──────────────┘│ │
│  │  Network layer, local storage, utilities                       │ │
│  └────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                              ↕ HTTP/HTTPS (REST API)
┌─────────────────────────────────────────────────────────────────────┐
│                          BACKEND SERVER                              │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                     EXPRESS.JS SERVER                           │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐         │ │
│  │  │   Auth   │ │ Tickets  │ │ Comments │ │  Users   │         │ │
│  │  │  Routes  │ │  Routes  │ │  Routes  │ │  Routes  │         │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘         │ │
│  │  API endpoints, request handling, response formatting          │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                ↕                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                        MIDDLEWARE                               │ │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐│ │
│  │  │  Authentication  │  │  File Upload     │  │  Error       ││ │
│  │  │  (JWT Verify)    │  │  (Multer)        │  │  Handler     ││ │
│  │  └──────────────────┘  └──────────────────┘  └──────────────┘│ │
│  │  Request processing, validation, authorization                 │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                ↕                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                      FILE STORAGE                               │ │
│  │              uploads/tickets/{ticketId}/                        │ │
│  │              uploads/comments/{commentId}/                      │ │
│  │  Local filesystem, organized by entity type and ID              │ │
│  └────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                              ↕ SQL Queries (mysql2)
┌─────────────────────────────────────────────────────────────────────┐
│                         MySQL DATABASE                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────────┐  │
│  │  users   │ │ tickets  │ │ comments │ │ ticket_attachments   │  │
│  │          │ │          │ │          │ │                      │  │
│  └──────────┘ └──────────┘ └──────────┘ └──────────────────────┘  │
│  ┌──────────────────────┐                                           │
│  │ comment_attachments  │                                           │
│  │                      │                                           │
│  └──────────────────────┘                                           │
│  Relational data storage with foreign keys and indexes              │
└─────────────────────────────────────────────────────────────────────┘
```

### 5.2. Структура базы данных

#### **Таблица: users**
Хранит информацию о всех пользователях системы.

```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    role ENUM('user', 'support', 'admin') DEFAULT 'user',
    position VARCHAR(100),
    mobile_phone VARCHAR(20),
    internal_phone VARCHAR(20),
    floor INT,
    office_number VARCHAR(20),
    is_blocked TINYINT(1) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_role (role),
    INDEX idx_is_blocked (is_blocked)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Описание полей:**
- `id` — уникальный идентификатор пользователя (PRIMARY KEY, AUTO_INCREMENT)
- `email` — email для входа (UNIQUE, используется для аутентификации)
- `password_hash` — хеш пароля, сгенерированный bcrypt
- `first_name`, `last_name` — имя и фамилия пользователя
- `role` — роль в системе (user/support/admin)
- `position` — должность (опционально)
- `mobile_phone` — мобильный телефон (опционально)
- `internal_phone` — внутренний телефон (опционально)
- `floor` — этаж (опционально)
- `office_number` — номер кабинета (опционально)
- `is_blocked` — флаг блокировки (0 = активен, 1 = заблокирован)
- `created_at` — дата и время регистрации
- `updated_at` — дата и время последнего обновления профиля

**Индексы:**
- `idx_email` — для быстрого поиска по email при входе
- `idx_role` — для фильтрации пользователей по ролям
- `idx_is_blocked` — для проверки блокировки

#### **Таблица: tickets**
Хранит информацию о заявках.

```sql
CREATE TABLE tickets (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    status ENUM('new', 'in_progress', 'resolved', 'closed', 'archived') DEFAULT 'new',
    priority ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',
    user_id INT NOT NULL,
    assigned_to INT,
    rating INT CHECK (rating >= 1 AND rating <= 5),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (assigned_to) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_status (status),
    INDEX idx_priority (priority),
    INDEX idx_user_id (user_id),
    INDEX idx_assigned_to (assigned_to),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Описание полей:**
- `id` — уникальный идентификатор заявки
- `title` — заголовок заявки (до 255 символов)
- `description` — подробное описание проблемы (TEXT, без ограничений)
- `status` — текущий статус заявки
- `priority` — приоритет заявки
- `user_id` — ID автора заявки (FOREIGN KEY → users.id)
- `assigned_to` — ID назначенного специалиста (FOREIGN KEY → users.id, nullable)
- `rating` — оценка работы от 1 до 5 (nullable, устанавливается после решения)
- `created_at` — дата и время создания заявки
- `updated_at` — дата и время последнего обновления

**Связи:**
- `user_id` → `users.id` (ON DELETE CASCADE — при удалении пользователя удаляются его заявки)
- `assigned_to` → `users.id` (ON DELETE SET NULL — при удалении специалиста поле обнуляется)

**Индексы:**
- `idx_status` — для фильтрации по статусу
- `idx_priority` — для сортировки по приоритету
- `idx_user_id` — для выборки заявок пользователя
- `idx_assigned_to` — для выборки заявок специалиста
- `idx_created_at` — для сортировки по дате

#### **Таблица: comments**
Хранит комментарии к заявкам.

```sql
CREATE TABLE comments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ticket_id INT NOT NULL,
    user_id INT NOT NULL,
    message TEXT NOT NULL,
    is_internal TINYINT(1) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_ticket_id (ticket_id),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Описание полей:**
- `id` — уникальный идентификатор комментария
- `ticket_id` — ID заявки (FOREIGN KEY → tickets.id)
- `user_id` — ID автора комментария (FOREIGN KEY → users.id)
- `message` — текст комментария
- `is_internal` — флаг внутреннего комментария (не используется в текущей версии)
- `created_at` — дата и время создания комментария

**Связи:**
- `ticket_id` → `tickets.id` (ON DELETE CASCADE)
- `user_id` → `users.id` (ON DELETE CASCADE)

**Индексы:**
- `idx_ticket_id` — для выборки комментариев заявки
- `idx_user_id` — для выборки комментариев пользователя
- `idx_created_at` — для сортировки по дате

#### **Таблица: ticket_attachments**
Хранит информацию о прикрепленных файлах к заявкам.

```sql
CREATE TABLE ticket_attachments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ticket_id INT NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INT NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE,
    INDEX idx_ticket_id (ticket_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Описание полей:**
- `id` — уникальный идентификатор вложения
- `ticket_id` — ID заявки (FOREIGN KEY → tickets.id)
- `file_name` — оригинальное имя файла
- `file_path` — путь к файлу на сервере (относительно корня проекта)
- `file_size` — размер файла в байтах
- `mime_type` — MIME-тип файла (image/jpeg, image/png)
- `uploaded_at` — дата и время загрузки

**Связи:**
- `ticket_id` → `tickets.id` (ON DELETE CASCADE)

#### **Таблица: comment_attachments**
Хранит информацию о прикрепленных файлах к комментариям.

```sql
CREATE TABLE comment_attachments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    comment_id INT NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INT NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (comment_id) REFERENCES comments(id) ON DELETE CASCADE,
    INDEX idx_comment_id (comment_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Описание полей:**
- `id` — уникальный идентификатор вложения
- `comment_id` — ID комментария (FOREIGN KEY → comments.id)
- `file_name` — оригинальное имя файла
- `file_path` — путь к файлу на сервере
- `file_size` — размер файла в байтах
- `mime_type` — MIME-тип файла
- `uploaded_at` — дата и время загрузки

**Связи:**
- `comment_id` → `comments.id` (ON DELETE CASCADE)

### 5.3. ER-диаграмма (связи между таблицами)

```
┌──────────────────┐
│      users       │
│──────────────────│
│ PK: id           │
│    email         │
│    password_hash │
│    first_name    │
│    last_name     │
│    role          │
│    ...           │
└──────────────────┘
        │ 1
        │
        │ N (user_id)
        ↓
┌──────────────────┐         ┌──────────────────────┐
│     tickets      │ 1     N │ ticket_attachments   │
│──────────────────│─────────│──────────────────────│
│ PK: id           │         │ PK: id               │
│ FK: user_id      │         │ FK: ticket_id        │
│ FK: assigned_to  │         │    file_name         │
│    title         │         │    file_path         │
│    description   │         │    file_size         │
│    status        │         │    mime_type         │
│    priority      │         └──────────────────────┘
│    rating        │
└──────────────────┘
        │ 1
        │
        │ N (ticket_id)
        ↓
┌──────────────────┐         ┌──────────────────────┐
│    comments      │ 1     N │ comment_attachments  │
│──────────────────│─────────│──────────────────────│
│ PK: id           │         │ PK: id               │
│ FK: ticket_id    │         │ FK: comment_id       │
│ FK: user_id      │         │    file_name         │
│    message       │         │    file_path         │
│    is_internal   │         │    file_size         │
└──────────────────┘         │    mime_type         │
        ↑                     └──────────────────────┘
        │ N (user_id)
        │
        │ 1
┌──────────────────┐
│      users       │
└──────────────────┘
```

**Описание связей:**
- `users` (1) ──< (N) `tickets` [user_id] — один пользователь может создать много заявок
- `users` (1) ──< (N) `tickets` [assigned_to] — один специалист может быть назначен на много заявок
- `users` (1) ──< (N) `comments` [user_id] — один пользователь может написать много комментариев
- `tickets` (1) ──< (N) `comments` [ticket_id] — одна заявка может иметь много комментариев
- `tickets` (1) ──< (N) `ticket_attachments` [ticket_id] — одна заявка может иметь много вложений
- `comments` (1) ──< (N) `comment_attachments` [comment_id] — один комментарий может иметь много вложений

---

*Продолжение следует в следующей части документа...*
